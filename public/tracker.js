"use strict";var Reev=(()=>{var c=class{constructor(t){this.events=[];this.batchInterval=null;this.maxScrollDepth=0;this.scrollTimeout=null;this.lastClickTrack=null;this.formStates=new Map;this.pageEnteredAt=Date.now();this.currentUrl="";this.observers=[];this.projectId=t.projectId,this.apiUrl=t.apiUrl||"",this.sessionId=this.generateSessionId(),this.currentUrl=location.href,this.init()}generateSessionId(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{let e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}now(){return Date.now()}push(t,e){this.events.push({type:t,data:e,timestamp:this.now()})}init(){try{this.trackPageview(),this.trackClicks(),this.trackScroll(),this.trackForms(),this.trackErrors(),this.trackVitals(),this.trackNavigation(),this.setupBatchSending(),this.setupUnloadHandler()}catch(t){}}trackPageview(){this.pageEnteredAt=this.now(),this.maxScrollDepth=0,this.push("pageview",{url:location.href,referrer:document.referrer,title:document.title,viewport:{w:window.innerWidth,h:window.innerHeight}})}trackClicks(){let t=e=>{let r=e.target;if(!r)return;let i=this.getSelector(r),s=(r.textContent||"").trim().slice(0,100),n=this.now(),o=!1;this.lastClickTrack&&this.lastClickTrack.selector===i&&n-this.lastClickTrack.firstClick<1e3?(this.lastClickTrack.count++,this.lastClickTrack.count>=3&&(o=!0)):this.lastClickTrack={selector:i,count:1,firstClick:n},this.push("click",{selector:i,text:s,x:e.clientX,y:e.clientY,isRage:o,url:location.href})};document.addEventListener("click",t,!0),this.observers.push(()=>document.removeEventListener("click",t,!0))}trackScroll(){let t=()=>{let e=window.scrollY||document.documentElement.scrollTop,r=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight),i=window.innerHeight,s=r-i;if(s<=0)return;let n=Math.min(100,Math.round(e/s*100));n>this.maxScrollDepth&&(this.maxScrollDepth=n),this.scrollTimeout&&clearTimeout(this.scrollTimeout),this.scrollTimeout=setTimeout(()=>{this.push("scroll",{maxDepth:this.maxScrollDepth,url:location.href})},500)};window.addEventListener("scroll",t,{passive:!0}),this.observers.push(()=>window.removeEventListener("scroll",t))}trackForms(){let t=r=>{let i=r.target;if(!this.isFormField(i))return;let s=i.form,n=s?s.id||s.getAttribute("name")||this.getSelector(s):"unknown",o=i.name||i.id||this.getSelector(i);this.formStates.has(n)||this.formStates.set(n,{fields:new Set,startedAt:this.now()}),this.formStates.get(n).fields.add(o),this.push("form",{action:"field_focus",formId:n,fieldName:o,url:location.href})},e=r=>{var n;let i=r.target,s=i.id||i.getAttribute("name")||this.getSelector(i);this.push("form",{action:"submit",formId:s,url:location.href,fieldCount:((n=this.formStates.get(s))==null?void 0:n.fields.size)||0,timeSpent:this.formStates.has(s)?this.now()-this.formStates.get(s).startedAt:0}),this.formStates.delete(s)};document.addEventListener("focusin",t,!0),document.addEventListener("submit",e,!0),this.observers.push(()=>{document.removeEventListener("focusin",t,!0),document.removeEventListener("submit",e,!0)})}trackErrors(){let t=r=>{this.push("error",{message:r.message,source:r.filename,line:r.lineno,col:r.colno,url:location.href})},e=r=>{this.push("error",{message:String(r.reason),source:"unhandled_promise_rejection",url:location.href})};window.addEventListener("error",t),window.addEventListener("unhandledrejection",e),this.observers.push(()=>{window.removeEventListener("error",t),window.removeEventListener("unhandledrejection",e)})}trackVitals(){if(typeof PerformanceObserver!="undefined"){try{let t=new PerformanceObserver(e=>{let r=e.getEntries(),i=r[r.length-1];i&&this.push("vitals",{metric:"lcp",value:Math.round(i.startTime),url:location.href})});t.observe({type:"largest-contentful-paint",buffered:!0}),this.observers.push(()=>t.disconnect())}catch(t){}try{let t=new PerformanceObserver(e=>{let r=e.getEntries()[0];r&&this.push("vitals",{metric:"fid",value:Math.round(r.processingStart-r.startTime),url:location.href})});t.observe({type:"first-input",buffered:!0}),this.observers.push(()=>t.disconnect())}catch(t){}try{let t=0,e=new PerformanceObserver(r=>{for(let i of r.getEntries())i.hadRecentInput||(t+=i.value)});e.observe({type:"layout-shift",buffered:!0}),this.observers.push(()=>{e.disconnect(),t>0&&this.push("vitals",{metric:"cls",value:Math.round(t*1e3)/1e3,url:location.href})})}catch(t){}}}trackNavigation(){let t=location.href,e=()=>{location.href!==t&&(this.maxScrollDepth>0&&this.push("scroll",{maxDepth:this.maxScrollDepth,url:t}),this.push("page_leave",{url:t,timeOnPage:this.now()-this.pageEnteredAt}),t=location.href,this.currentUrl=location.href,this.maxScrollDepth=0,this.pageEnteredAt=this.now(),this.trackPageview())},r=history.pushState,i=history.replaceState;history.pushState=function(...s){r.apply(this,s),e()},history.replaceState=function(...s){i.apply(this,s),e()},window.addEventListener("popstate",e),this.observers.push(()=>{window.removeEventListener("popstate",e),history.pushState=r,history.replaceState=i})}setupBatchSending(){this.batchInterval=setInterval(()=>{this.sendBatch()},1e4)}setupUnloadHandler(){let t=()=>{this.batchInterval&&(clearInterval(this.batchInterval),this.batchInterval=null),this.maxScrollDepth>0&&this.push("scroll",{maxDepth:this.maxScrollDepth,url:location.href}),this.push("page_leave",{url:location.href,timeOnPage:this.now()-this.pageEnteredAt});for(let[e,r]of this.formStates)this.push("form",{action:"abandon",formId:e,url:location.href,fieldCount:r.fields.size,timeSpent:this.now()-r.startedAt});this.formStates.clear();for(let e of this.observers)try{e()}catch(r){}this.sendBatch(!0)};window.addEventListener("beforeunload",t),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&t()})}sendBatch(t=!1){if(this.events.length===0)return;let e=this.events.splice(0),r=`${this.apiUrl}/api/events`,i=JSON.stringify({sessionId:this.sessionId,projectId:this.projectId,events:e});if(t&&typeof navigator.sendBeacon=="function"){navigator.sendBeacon(r,i);return}fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:i,keepalive:t}).catch(()=>{t||this.events.unshift(...e)})}getSelector(t){if(t.id)return`#${t.id}`;let e=t.tagName.toLowerCase(),r=Array.from(t.classList).filter(n=>!n.startsWith("rr-")).slice(0,2).join("."),i=t.parentElement,s="";return i&&Array.from(i.children).filter(o=>o.tagName===t.tagName).length>1&&(s=`:nth-child(${Array.from(i.children).indexOf(t)+1})`),`${e}${r?"."+r:""}${s}`}isFormField(t){let e=t.tagName.toLowerCase();return e==="input"||e==="textarea"||e==="select"||t.getAttribute("contenteditable")==="true"}stop(){this.batchInterval&&(clearInterval(this.batchInterval),this.batchInterval=null);for(let t of this.observers)try{t()}catch(e){}this.observers=[]}};function l(){let a=document.currentScript;if(!a){let r=document.querySelectorAll("script[data-project-id]");r.length>0&&(a=r[r.length-1])}if(!a)return;let t=a.getAttribute("data-project-id");if(!t)return;let e=a.getAttribute("data-api-url")||"";new c({projectId:t,apiUrl:e})}typeof window!="undefined"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",l):l());})();
